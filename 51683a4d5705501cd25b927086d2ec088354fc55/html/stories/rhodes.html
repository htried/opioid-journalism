<!DOCTYPE html>
<html>
<head>
      <link rel="stylesheet" href="cece-styles.css">
      <script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>
  <style>
  .axis path,
  .axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
  }

  .x.axis path {
    display: none;
  }

  .line {
    fill: none;
    stroke: steelblue;
    stroke-width: 1.5px;
  }
  </style>
  <title>Rhodes</title>
</head>

<body>

  <ul>
    <li><a style="font-family: auto" href="https://htried.github.io/opioid-journalism/51683a4d5705501cd25b927086d2ec088354fc55/html/stories/pharmacies.html">ARCOS/Pharmacies</a></li>
    <li><a style="font-family: auto" href="https://htried.github.io/opioid-journalism/51683a4d5705501cd25b927086d2ec088354fc55/html/stories/dollars4docs.html">Dollars for Docs</a></li>
    <li><a style="font-family: auto" href="https://htried.github.io/opioid-journalism/51683a4d5705501cd25b927086d2ec088354fc55/html/stories/iwp.html">Injured Workers Pharmacy</a></li>
    <li><a style="font-family: auto" href="https://htried.github.io/opioid-journalism/51683a4d5705501cd25b927086d2ec088354fc55/html/stories/ods.html">Overdoses in Providence</a></li>
    <li><a style="font-family: auto" href="https://htried.github.io/opioid-journalism/51683a4d5705501cd25b927086d2ec088354fc55/html/stories/courtdata.html">Court Data</a></li>
  </ul>

<h1> Rhodes </h1>

<h2> Basic Information </h2>

<ul>
  <li><b>Rhodes produces drugs out of Coventry, RI</b></li>
  <ul>
      <li>Street address is 498 Washington Street, Coventry, RI, 02816</li>
      <li>According to an archived version of the company's website, the facility has a drug production capacity of over 30,000 gallons. They offer "confidential production of high purity APIs [active pharmaceutical ingredients]," and boast about how Coventry is "in the heart of the US Northeast pharmaceutical corridor."</li>
      <li>According to DEA and Department of Justice documentation, as of March 2018, Rhodes was licensed to produce fourteen different opioid products, including oxycodone, hydrocodone, morphine, and fentanyl.</li>
      <li>Opioid drug production has been particularly high in the past several years - FT reported that in 2016, for instance, Rhodes and Purdue together produced 14.4 million opioid prescriptions, accounting for 6 percent of the total US market share of prescriptions in that year. This market share makes them the 7th largest producer of opioids in the country.<br>
        <img src="./img/opioid-market.png" alt="purdue rhodes market share"></li>
      <li>As of 2018, David Sackler and Purdue granted Rhodes and patent for fast-dissolving buprenorphine wafers - a drug intended for the treatment of opioid addiction and one that has become steadily more popular and lucrative as medication-assisted treatment has gained traction in the US.</li>
  </ul>
  <li><b>People</b></li>
  <ul>
    <li>There are ~130 people who work at Rhodes. Known employees linked <a href="https://docs.google.com/spreadsheets/d/1P9NEz9ezBQgVJQWb6WaV4I0g8N_V6HEdFDAtlgqqkpI/edit#gid=0">here</a>.
    <li/>According to an FT article circa 2018, hundreds of employees have left Rhodes and Purdue in recent years, some of them after having friends or family get addicted to opioids.
    <li/>Known executives/board members:
    <ul>
      <li>Frank Peter Boer, President
      <li/>Stuart D Baker, VP
      <li/>Marc Kesselman, general counsel of Purdue (on legal paperwork)
      <li/><b>Sacklers:</b> Theresa Sackler, Kathe Sackler, Jonathan Sackler, Mortimer Sackler, David Sackler
      <li/><b>Rhodes Governance Committee:</b> Theresa Sackler (Chairperson), Kathe Sackler, and Jonathan Sackler
      <li/><b>Rhodes Business Development Committee:</b> Kathe Sackler, Jonathan Sackler, Mortimer Sackler, and David Sackler</li>
    </ul>
  </ul>
  <li><b>Rhodes and Purdue Pharmaceuticals are not independent entities</b></li>
    <ul>
      <li/>Since 2007, Rhodes Pharmaceuticals has been owned and operated as a subsidiary of Purdue Pharmaceuticals. They produce generic opioids: oxycodone instead of OxyContin, morphine sulfate instead of MS Contin, etc. Although the two companies are ostensibly different, they share executives and much of the same management structure. Employees within the two companies, FT reports, make little distinction between the two. In fact, staff in the two companies share the same employee handbook. <li/>Even their corporate mailing address is the same - One Stamford Forum in Connecticut, the location of Purdue's headquarters.
      <li/>Rhodes was acquired by Purdue in 2007, just four months after Purdue paid over $700 million in fines in the largest opioid settlement ever to that point. According to the MA lawsuit against Purdue, Peter Boer, who was the president of Rhodes at the time, drafted a <a href="https://www.washingtonpost.com/context/memo-to-richard-sackler-from-adviser/48b78ae2-1b46-4b84-ad24-7d989dec58c5/?itid=lk_interstitial_manual_4">secretive memo</a> for the Sackler family, stating that "the perception of a sound long-term plan and effective management will translate into maximizing value" for the Sacklers, allowing them to sell the company for billions to "strategic buyers."
      <li/>Peter Boer, the president of the board of Rhodes, has also been a director at Purdue since 2008, and is one of the named defendants in the MA lawsuit against Purdue. The lawsuit describes how Boer, with other defendants, "did not act independently from the Sacklers." Over more than a decade, Boer "voted with the Sacklers on <u>every single one</u> of the hundreds of votes" on the Purdue board.
      <li/>According to the NY lawsuit against Purdue and Rhodes, "Purdue and the Sacklers oversaw and approved all Rhodes-related activity." The Sacklers received copies of the agendas for every Rhodes board meeting, as well as regular financial statements and results. Further, Rhodes "relied on Purdue for compliance; for example, in 2018, Rhodes' Compliance Committee discussed the suspicious ordering system and statistics for 2018 as provided by Purdue." Rhodes also contributed millions of dollars to two shell companies owned by the Sacklers, "for the benefit of the Sackler Families."
      <li/>Even post-bankruptcy, monthly bankruptcy reports show that tens of millions of dollars are being transferred between the companies on a monthly basis.
      <li/>In a FT article, former Purdue sales representatives said that they were given bonuses in part based on the overall growth of the prescription opioid market - an arrangement that incentivized the promotion of generics in addition to Purdue's name brand drugs. Those generics would include oxycodone produced by Rhodes. This strategy was described as a "one, two punch" to FT by a former senior manager at Purdue. The intuition was that if Purdue could get doctors to prescribe generic oxycodone, like the drug made by their subsidiary Rhodes, they could eventually get a user to switch to OxyContin.
    </ul>
  <li><b>Charges against Rhodes</b></li>
    <ul>
      <li/>In RI, Rhodes was charged with Public Nuisance, Violations of the State's False Claims Act, Fraudulent Misrepresentation, Negligence and Negligent Misrepresentation, and Unjust Enrichment
      <li/>Also being sued in New York.
      <li/>The Massachusetts lawsuit doesn't name Rhodes as a defendant, but talks about the corrosive sales tactics used by Purdue in southern Massachusetts, particularly in Bristol County, right on the border of MA and RI.
      <ul>
        <li>"In Bristol County, Purdue targeted a doctor in Fall River. Since 2008, Purdue sales reps visited this doctor more than six hundred times. In 2015, Purdue's rep was in his office almost every workday:<br>
          <img src="./img/purdue-rep.jpg" alt="purdue sales rep" style="width:500px;height:500;"><br>
          &emsp;&emsp;Purdue repeatedly asked the Fall River doctor to "commit" to prescribing its opioids, and he agreed over and over, day by day. For example, during the week of April 6-10, 2015: Purdue's rep met the doctor at his office on Monday to discuss patients who would be coming in that day. On Tuesday, the salesperson met with the doctor again and confirmed that the doctor had put the patients on Purdue opioids. On Wednesday, Purdue's salesperson came to the doctor's office again to discuss more patients. And again on Thursday. And again on Friday. On the following Monday, the Purdue rep came back to talk with the doctor again.<br>
          &emsp;&emsp;The Fall River doctor told Purdue that he "loves the idea" of Purdue's Butrans opioid and was putting "more and more" patients on Purdue's OxyContin. The next month, Purdue gave the doctor a consulting contract worth up to $48,000 to promote Purdue opioids. Purdue ended up paying him more than $50,000. In turn, the doctor prescribed more than 180,000 pills of Purdue opioids - enough for Purdue to collect more than $1.4 million." (43)
        <li/>"For example, staff reported to the Board that Purdue suspected Dr. Michael Taylor, in New Bedford, Massachusetts, was prescribing opioids inappropriately. Staff reported to the Board that, in the past two years, Taylor had prescribed OxyContin more than five hundred times, and provided Purdue with $392,505." (104)</li>
      </ul>
    </ul>
</ul>

<h1>Original data analysis and graphics</h1>
<p>
  The following data analysis was performed on the DEA Opioid Prescription Dataset (ARCOS) we obtained. The ARCOS dataset tracks the path of every single pain pill sold in the US from 2006-2014. This dataset required extensive cleaning and the analysis was done on Google Colab (Colaboratory) Python Notebooks.
</p>

<!-- Mulit-line charts -->

<h2>Rhodes Drug Types Over Time (Quantity)</h2>

<div id="container" class="svg-container"></div>
<script>
const width = 960;
const height = 420;
const margin = 5;
const padding = 5;
const adj = 70;

  var parseDate = d3.timeParse("%Y-%m");

  var x = d3.scaleTime()
    .range([0, width]);

  var y = d3.scaleLinear()
    .range([height, 0]);

  var color = d3.scaleOrdinal(d3.schemeCategory10);

  var xAxis = d3.axisBottom(x);

  var yAxis = d3.axisLeft().scale(y);

  var line = d3.line()
    .x(function(d) {
      return x(d.date);
    })
    .y(function(d) {
      return y(d.quantity);
    });

    var svg = d3.select("div#container").append("svg")
    .attr("preserveAspectRatio", "xMinYMin meet")
    .attr("viewBox", "-"
          + adj + " -"
          + adj + " "
          + (width + adj *3) + " "
          + (height + adj*3))
    .style("padding", padding)
    .style("margin", margin)
    .classed("svg-content", true);


  const quantity_data = d3.csv("../graphs/data/rhodes_drug_by_date_quantity.csv");//.then(d => graph(d))
  quantity_data.then(function graph(data) {
  color.domain(d3.keys(data[0]).filter(function(key) {
    return key !== "date";
  }));

  data.forEach(function(d) {
    d.date = parseDate(d.date)
  })

  var drugs = color.domain().map(function(name) {
    return {
      name: name.split(' ')[0],
      values: data.map(function(d) {
        return {
          date: d.date,
          quantity: +d[name]
        };
      })
    };
  });

  x.domain(d3.extent(data, function(d) {
    return d.date;
  }));

  y.domain([(0), d3.max(drugs, function(d) {
      return d3.max(d.values, function(v) {
          return v.quantity; });
          })
      ]);

  var legend = svg.selectAll('g')
    .data(drugs)
    .enter()
    .append('g')
    .attr('class', 'legend');

  legend.append('rect')
    .attr('x', width - 20)
    .attr('y', function(d, i) {
      return i * 20;
    })
    .attr('width', 10)
    .attr('height', 10)
    .style('fill', function(d) {
      return color(d.name);
    });

  legend.append('text')
    .attr('x', width - 8)
    .attr('y', function(d, i) {
      return (i * 20) + 9;
    })
    .text(function(d) {
      return d.name;
    });

  svg.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + height + ")")
    .call(xAxis);

  svg.append("g")
    .attr("class", "y axis")
    .call(yAxis)
    .append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", 6)
    .attr("dy", ".71em")
    .style("text-anchor", "end")
    .text("Quantity");

  var drug = svg.selectAll(".drug")
    .data(drugs)
    .enter().append("g")
    .attr("class", "drug");

  drug.append("path")
    .attr("class", "line")
    .attr("d", function(d) {
      return line(d.values);
    })
    .style("stroke", function(d) {
      return color(d.name);
    });

  drug.append("text")
    .datum(function(d) {
      return {
        name: d.name,
        value: d.values[d.values.length - 1]
      };
    })
    .attr("transform", function(d) {
      return "translate(" + x(d.value.date) + "," + y(d.value.quantity) + ")";
    })
    .attr("x", 3)
    .attr("dy", ".35em")
    .text(function(d) {
      return d.name;
    });

  var mouseG = svg.append("g")
    .attr("class", "mouse-over-effects");

  mouseG.append("path") // this is the black vertical line to follow mouse
    .attr("class", "mouse-line")
    .style("stroke", "black")
    .style("stroke-width", "1px")
    .style("opacity", "0");

  var lines = document.getElementsByClassName('line');

  var mousePerLine = mouseG.selectAll('.mouse-per-line')
    .data(drugs)
    .enter()
    .append("g")
    .attr("class", "mouse-per-line");

  mousePerLine.append("circle")
    .attr("r", 7)
    .style("stroke", function(d) {
      return color(d.name);
    })
    .style("fill", "none")
    .style("stroke-width", "1px")
    .style("opacity", "0");

  mousePerLine.append("text")
    .attr("transform", "translate(10,3)");

  mouseG.append('svg:rect') // append a rect to catch mouse movements on canvas
    .attr('width', width) // can't catch mouse events on a g element
    .attr('height', height)
    .attr('fill', 'none')
    .attr('pointer-events', 'all')
    .on('mouseout', function() { // on mouse out hide line, circles and text
      d3.select(".mouse-line")
        .style("opacity", "0");
      d3.selectAll(".mouse-per-line circle")
        .style("opacity", "0");
      d3.selectAll(".mouse-per-line text")
        .style("opacity", "0");
    })
    .on('mouseover', function() { // on mouse in show line, circles and text
      d3.select(".mouse-line")
        .style("opacity", "1");
      d3.selectAll(".mouse-per-line circle")
        .style("opacity", "1");
      d3.selectAll(".mouse-per-line text")
        .style("opacity", "1");
    })
    .on('mousemove', function() { // mouse moving over canvas
      var mouse = d3.mouse(this);
      d3.select(".mouse-line")
        .attr("d", function() {
          var d = "M" + mouse[0] + "," + height;
          d += " " + mouse[0] + "," + 0;
          return d;
        });

      d3.selectAll(".mouse-per-line")
        .attr("transform", function(d, i) {
          var xDate = x.invert(mouse[0]),
              bisect = d3.bisector(function(d) { return d.date; }).right;
              idx = bisect(d.values, xDate);

          var beginning = 0,
              end = lines[i].getTotalLength(),
              target = null;

          while (true){
            target = Math.floor((beginning + end) / 2);
            pos = lines[i].getPointAtLength(target);
            if ((target === end || target === beginning) && pos.x !== mouse[0]) {
                break;
            }
            if (pos.x > mouse[0])      end = target;
            else if (pos.x < mouse[0]) beginning = target;
            else break; //position found
          }

          d3.select(this).select('text')
            .text(y.invert(pos.y).toFixed(2));

          return "translate(" + mouse[0] + "," + pos.y +")";
        });
    });
})
</script>

<!-- Mulit-line charts -->

<h2>Rhodes Drug Types Over Time (MME)</h2>

<div id="container2" class="svg-container2"></div>
<script>

  var parseDate = d3.timeParse("%Y-%m");

  var x = d3.scaleTime()
    .range([0, width]);

  var y = d3.scaleLinear()
    .range([height, 0]);

  var color = d3.scaleOrdinal(d3.schemeCategory10);

  var xAxis = d3.axisBottom(x);

  var yAxis = d3.axisLeft().scale(y);

  var line = d3.line()
    .x(function(d) {
      return x(d.date);
    })
    .y(function(d) {
      return y(d.quantity);
    });

  const svg2 = d3.select("div#container2").append("svg")
    .attr("preserveAspectRatio", "xMinYMin meet")
    .attr("viewBox", "-"
          + adj + " -"
          + adj + " "
          + (width + adj *3) + " "
          + (height + adj*3))
    .style("padding", padding)
    .style("margin", margin)
    .classed("svg-content", true);


  const mme_data = d3.csv("../graphs/data/rhodes_drug_by_date_mme.csv");//.then(d => graph(d))
  mme_data.then(function graph(data) {

  color.domain(d3.keys(data[0]).filter(function(key) {
    return key !== "date";
  }));

  data.forEach(function(d) {
    d.date = parseDate(d.date)
  })

  var drugs = color.domain().map(function(name) {
    return {
      name: name.split(' ')[0],
      values: data.map(function(d) {
        return {
          date: d.date,
          quantity: +d[name]
        };
      })
    };
  });

  console.log(drugs)

  x.domain(d3.extent(data, function(d) {
    return d.date;
  }));

  y.domain([(0), d3.max(drugs, function(d) {
      return d3.max(d.values, function(v) {
          return v.quantity; });
          })
      ]);

  var legend = svg2.selectAll('g')
    .data(drugs)
    .enter()
    .append('g')
    .attr('class', 'legend');

  legend.append('rect')
    .attr('x', width - 20)
    .attr('y', function(d, i) {
      return i * 20;
    })
    .attr('width', 10)
    .attr('height', 10)
    .style('fill', function(d) {
      return color(d.name);
    });

  legend.append('text')
    .attr('x', width - 8)
    .attr('y', function(d, i) {
      return (i * 20) + 9;
    })
    .text(function(d) {
      return d.name;
    });

  svg2.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + height + ")")
    .call(xAxis);

  svg2.append("g")
    .attr("class", "y axis")
    .call(yAxis)
    .append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", 6)
    .attr("dy", ".71em")
    .style("text-anchor", "end")
    .text("MME");

  var drug = svg2.selectAll(".drug")
    .data(drugs)
    .enter().append("g")
    .attr("class", "drug");

  drug.append("path")
    .attr("class", "line")
    .attr("d", function(d) {
      return line(d.values);
    })
    .style("stroke", function(d) {
      return color(d.name);
    });

  drug.append("text")
    .datum(function(d) {
      return {
        name: d.name,
        value: d.values[d.values.length - 1]
      };
    })
    .attr("transform", function(d) {
      return "translate(" + x(d.value.date) + "," + y(d.value.quantity) + ")";
    })
    .attr("x", 3)
    .attr("dy", ".35em")
    .text(function(d) {
      return d.name;
    });

  var mouseG2 = svg2.append("g")
    .attr("class", "mouse-over-effects");

  mouseG2.append("path") // this is the black vertical line to follow mouse
    .attr("class", "mouse-line2")
    .style("stroke", "black")
    .style("stroke-width", "1px")
    .style("opacity", "0");

  var lines = document.getElementsByClassName('line');

  var mousePerLine = mouseG2.selectAll('.mouse-per-line')
    .data(drugs)
    .enter()
    .append("g")
    .attr("class", "mouse-per-line");

  mousePerLine.append("circle")
    .attr("r", 7)
    .style("stroke", function(d) {
      return color(d.name);
    })
    .style("fill", "none")
    .style("stroke-width", "1px")
    .style("opacity", "0");

  mousePerLine.append("text")
    .attr("transform", "translate(10,3)");

  mouseG2.append('svg:rect') // append a rect to catch mouse movements on canvas
    .attr('width', width) // can't catch mouse events on a g element
    .attr('height', height)
    .attr('fill', 'none')
    .attr('pointer-events', 'all')
    .on('mouseout', function() { // on mouse out hide line, circles and text
      d3.select(".mouse-line")
        .style("opacity", "0");
      d3.selectAll(".mouse-per-line circle")
        .style("opacity", "0");
      d3.selectAll(".mouse-per-line text")
        .style("opacity", "0");
    })
    .on('mouseover', function() { // on mouse in show line, circles and text
      d3.select(".mouse-line")
        .style("opacity", "1");
      d3.selectAll(".mouse-per-line circle")
        .style("opacity", "1");
      d3.selectAll(".mouse-per-line text")
        .style("opacity", "1");
    })
    .on('mousemove', function() { // mouse moving over canvas
      var mouse = d3.mouse(this);
      d3.select(".mouse-line")
        .attr("d", function() {
          var d = "M" + mouse[0] + "," + height;
          d += " " + mouse[0] + "," + 0;
          return d;
        });

      d3.selectAll(".mouse-per-line")
        .attr("transform", function(d, i) {
          var xDate = x.invert(mouse[0]),
              bisect = d3.bisector(function(d) { return d.date; }).right;
              idx = bisect(d.values, xDate);

          var beginning = 0,
              end = lines[i].getTotalLength(),
              target = null;

          while (true){
            target = Math.floor((beginning + end) / 2);
            pos = lines[i].getPointAtLength(target);
            if ((target === end || target === beginning) && pos.x !== mouse[0]) {
                break;
            }
            if (pos.x > mouse[0])      end = target;
            else if (pos.x < mouse[0]) beginning = target;
            else break; //position found
          }

          d3.select(this).select('text')
            .text(y.invert(pos.y).toFixed(2));

          return "translate(" + mouse[0] + "," + pos.y +")";
        });
    });
})
</script>



<!-- PURDUE DONUT CHART -->

<h2>Purdue Drug Types Donut Chart</h2>

<!-- <div class="dropdown">
 <button onclick="myFunction()" class="dropbtn">Year</button>
 <div id="myDropdown" class="dropdown-content">
   <a class="six">2006</a>
   <a class="seven">2007</a>
   <a class="eight">2008</a>
   <a class="nine">2009</a>
   <a class="ten">2010</a>
   <a class="eleven">2011</a>
   <a class="twelve">2012</a>
   <a class="thirteen">2013</a>
   <a class="fourteen">2014</a>
 </div>
</div> -->

<!-- <div id="container" class="svg-container"></div> -->

<!-- <script>

function myFunction() {
  document.getElementById("myDropdown").classList.toggle("show");
}

window.onclick = function(event) {
  if (!event.target.matches('.dropbtn')) {
    var dropdowns = document.getElementsByClassName("dropdown-content");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
}

var width = 960,
    height = 450,
    margin = 30,
    padding = 5,
    adj = 5;
    radius = Math.min(width, height) / 2;

var svg = d3.select("div#container")
    .append("svg")
    .append("g")
    .append("svg")
        .attr("preserveAspectRatio", "xMinYMin meet")
        .attr("viewBox", "-"
              + adj + " -"
              + adj + " "
              + (width + adj *3) + " "
              + (height + adj*3))
        .style("padding", padding)
        .style("margin", margin)
        .classed("svg-content", true);

svg.append("g")
    .attr("class", "slices");
svg.append("g")
    .attr("class", "labels");
svg.append("g")
    .attr("class", "lines");

var pie = d3.layout.pie()
    .sort(null)
    .value(function(d) {
        return d.value;
    });

var arc = d3.svg.arc()
    .innerRadius(radius * 0.4)
    .outerRadius(radius * 0.8);

var outerArc = d3.svg.arc()
    .innerRadius(radius * 0.9)
    .outerRadius(radius * 0.9);

svg.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

var key = function(d){ return d.data.label; };

var color = d3.scale.ordinal()
    .domain(["HYDROMORPHONE HYDROCHLORIDE", "HYDROCODONE BITARTRATE HEMIPENTAHYDRATE", "OXYCODONE HYDROCHLORIDE", "BUPRENORPHINE", "MORPHINE SULFATE PENTAHYDRATE(I.E.,5H20)"])
    .range(["#98abc5", "#8a89a6", "#6b486b", "#a05d56", "#ff8c00"]);

var legend = d3.select("div#container").append("svg")
      .attr("class", "legend")
      .attr("width", radius * 2)
      .attr("height", radius * 2)
    .selectAll("g")
      .data(color.domain().slice())
    .enter().append("g")
      .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

  legend.append("rect")
      .attr("width", 18)
      .attr("height", 18)
      .style("fill", color);

  legend.append("text")
      .attr("x", 24)
      .attr("y", 9)
      .attr("dy", ".35em")
      .text(function(d) { return d; });

function getData (year_selected) {
  return d3.csv("../graphs/data/purdue_drug_types.csv", function(d) {
    return {
      year: d.year,
      name : d.Ingredient_Name,
      quantity : d.QUANTITY,
    };
  }, function(data) {
    console.log(data)
    console.log(year_selected)
    var filtered = data.filter(function (d) { console.log(d.year == year_selected)
      return d.year == year_selected});
    console.log("filtered")
    console.log(filtered)
    var zipped = filtered.map(function(label, i) {
        var val =  { label: filtered[i].name, value: filtered[i].quantity }
        return val
    });
console.log("zipped")
    console.log(zipped)
    change(zipped)
  });
}

getData("2006");

d3.select(".six")
  .on("click", function(){
        getData("2006");
    });

d3.select(".seven")
  .on("click", function(){
        getData("2007");
    });

d3.select(".eight")
  .on("click", function(){
        getData("2008");
    });

d3.select(".nine")
  .on("click", function(){
        getData("2009");
    });

d3.select(".ten")
    .on("click", function(){
        getData("2010");
    });

d3.select(".eleven")
    .on("click", function(){
        getData("2011");
    });

d3.select(".twelve")
    .on("click", function(){
        getData("2012");
    });

d3.select(".thirteen")
    .on("click", function(){
        getData("2013");
    });

d3.select(".fourteen")
    .on("click", function(){
        getData("2014");
    });

function change(data) {

    /* ------- PIE SLICES -------*/
    var slice = svg.select(".slices").selectAll("path.slice")
        .data(pie(data), key);

    slice.enter()
        .insert("path")
        .style("fill", function(d) { return color(d.data.label); })
        .attr("class", "slice");

    slice
        .transition().duration(1000)
        .attrTween("d", function(d) {
            this._current = this._current || d;
            var interpolate = d3.interpolate(this._current, d);
            this._current = interpolate(0);
            return function(t) {
                return arc(interpolate(t));
            };
        })

    slice.exit()
        .remove();

    /* ------- TEXT LABELS -------*/

    var text = svg.select(".labels").selectAll("text")
        .data(pie(data), key);

    text.enter()
        .append("text")
        .attr("dy", ".35em")
        .text(function(d) {
            return d.data.label.split(" ")[0];
        });

    function midAngle(d){
        return d.startAngle + (d.endAngle - d.startAngle)/2;
    }

    text.transition().duration(1000)
        .attrTween("transform", function(d) {
            this._current = this._current || d;
            var interpolate = d3.interpolate(this._current, d);
            this._current = interpolate(0);
            return function(t) {
                var d2 = interpolate(t);
                var pos = outerArc.centroid(d2);
                pos[0] = radius * (midAngle(d2) < Math.PI ? 1 : -1);
                return "translate("+ pos +")";
            };
        })
        .styleTween("text-anchor", function(d){
            this._current = this._current || d;
            var interpolate = d3.interpolate(this._current, d);
            this._current = interpolate(0);
            return function(t) {
                var d2 = interpolate(t);
                return midAngle(d2) < Math.PI ? "start":"end";
            };
        });

    text.exit()
        .remove();

    /* ------- SLICE TO TEXT POLYLINES -------*/

    var polyline = svg.select(".lines").selectAll("polyline")
        .data(pie(data), key);

    polyline.enter()
        .append("polyline");

    polyline.transition().duration(1000)
        .attrTween("points", function(d){
            this._current = this._current || d;
            var interpolate = d3.interpolate(this._current, d);
            this._current = interpolate(0);
            return function(t) {
                var d2 = interpolate(t);
                var pos = outerArc.centroid(d2);
                pos[0] = radius * 0.95 * (midAngle(d2) < Math.PI ? 1 : -1);
                return [arc.centroid(d2), outerArc.centroid(d2), pos];
            };
        });

    polyline.exit()
        .remove();
};

</script> -->


</body>
</html>
